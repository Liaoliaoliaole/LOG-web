<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="shortcut icon" type="image/x-icon" href="/art/Morfeas_logo_yellow.ico">
<title>Morfeas Component</title>
</head>
<body>
<table style="margin:auto;text-align:left;margin-bottom:.075in;">
	<tr>
		<th colspan="2" style="font-weight: bold; font-size: xx-large">Add Component</th>
	</tr>
	<tr>
		<td>Component Type:</td>
		<td>
			<select id="comp_type" onchange="new_comp(this[this.selectedIndex])">
				<option>None</option>
				<option value="SDAQ_HANDLER">SDAQ</option>
				<option value="MDAQ_HANDLER">MDAQ</option>
				<option value="IOBOX_HANDLER">IO-BOX</option>
				<option value="MTI_HANDLER">MTI</option>
			</select>
		</td>
	</tr>
</table>
<table id="comp_add_table_data" style="margin:auto;text-align:left;margin-bottom:.075in;"></table>
<table style="margin:auto;text-align:left;margin-bottom:.075in;">
	<tr>
		<td>
		<input type="button" value="Okay" onclick="comp_val_and_add()">
		<input type="button" value="Cancel" onclick="window.close()">
		</td>
	</tr>
</table>
</body>
<script src='../morfeas_ecma/common.js'></script>
<script>
//@license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3.0
/*
@licstart  The following is the entire license notice for the
JavaScript code in this page.

Copyright (C) 12019-12020  Sam Harry Tzavaras

The JavaScript code in this page is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU AGPL) as published by the Free Software
Foundation, either version 3 of the License, or any later version.
The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU AGPL for more details.

@licend  The above is the entire license notice
for the JavaScript code in this page.
*/
	"use strict";
	document.getElementById('comp_type').selectedIndex = 0;
	var can_ifs_names;
	//AJAX object for configuration receive and send
	var xhttp = new XMLHttpRequest();
	xhttp.timeout = 5000;
	xhttp.onreadystatechange = function()
	{
		if(this.readyState == 4)
		{
			if(this.status == 200)
			{
				if(this.getResponseHeader("Content-Type")==="getCANifs_names/json")
					can_ifs_names = JSON.parse(this.responseText);
				else
					alert(this.responseText);
			}
			else if(this.status == 500)
				alert("FATAL Error on server!!!");
		}
	};
	xhttp.ontimeout = function(){
		alert("Client: Communication Error!!!");
	};
	//Get CAN-IFs names
	xhttp.open("GET", "../morfeas_php/config.php"+"?COMMAND=getCANifs_names", true);
	xhttp.send();

	var caller_res = window.opener;
	var comp_data_table = document.getElementById('comp_add_table_data');
	function new_comp(sel)
	{
		comp_data_table.innerHTML = "";
		if(!sel.index)
			return;
		//--Make Head--//
		let th = document.createElement("th");
		th.setAttribute("colspan","2");
		let textnode = document.createTextNode("Component's Properties");
		th.appendChild(textnode);
		comp_data_table.appendChild(th);
		switch(sel.value)
		{
			case "SDAQ_HANDLER":
				if(!can_ifs_names)
					alert("No CAN-IFs found!!!");
				else
					canif_table_constractor(comp_data_table, can_ifs_names);
				break;
			case "MDAQ_HANDLER":
			case "IOBOX_HANDLER":
			case "MTI_HANDLER":
				modbus_related_table_constractor(comp_data_table);
				break;
		}
	}
	function canif_table_constractor(_table, _can_ifs_names)
	{
		var tr,td,select,option,textnode;

		tr = _table.insertRow();
		td = document.createElement("td");
		textnode = document.createTextNode("CAN-IF");
		td.appendChild(textnode);
		tr.appendChild(td);
		td = document.createElement("td");
		select = document.createElement("select");
		select.setAttribute("name","can_if");
		for(let i=0;i<_can_ifs_names.length;i++)
		{
			option = document.createElement("option");
			option.setAttribute("value",_can_ifs_names[i]);
			textnode = document.createTextNode(_can_ifs_names[i]);
			option.appendChild(textnode);
			select.appendChild(option);
		}
		td.appendChild(select);
		tr.appendChild(td);
	}
	function modbus_related_table_constractor(_table)
	{
		const prop=["DEV_NAME","IPv4_ADDR"];
		var tr,td,input,textnode;
		for(let i=0;i<prop.length;i++)
		{
			tr = _table.insertRow();
			td = document.createElement("td");
			textnode = document.createTextNode(prop[i]+':');
			td.appendChild(textnode);
			tr.appendChild(td);
			td = document.createElement("td");
			input = document.createElement("input");
			input.setAttribute("name",prop[i]);
			input.setAttribute("maxlength","20");
			input.oninput = function(){this.value = this.value.replace(" ","");};
			input.onchange = function(){inp_validate(this)};
			td.appendChild(input);
			tr.appendChild(td);
		}
	}
	function inp_validate(elem)
	{
		if(elem.name === "IPv4_ADDR")
		{
			if(!ip_addr_val(elem.value))
			{
				elem.value = "";
				alert("You have entered an invalid IP address!");
				return;
			}
		}
		else if(elem.name === "DEV_NAME")
		{
			
		}
	}
//@license-end
</script>
</html>
