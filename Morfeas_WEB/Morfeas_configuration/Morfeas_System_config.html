<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/x-icon" href="/art/Morfeas_logo_yellow.ico">
<link rel="stylesheet" type="text/css" href="Morfeas_System_config.css">
<title>Morfeas WEB</title>
</head>
<body>
<div class="content">
	<table style="margin:auto;text-align:center;margin-bottom:.075in;">
	  <tr>
		<th colspan="4" style="font-weight: bold; font-size: xx-large">System Configuration</th>
	  </tr>
	  <tr>
		<td><input type="button" value="Morfeas system" onclick="disp_sel(disp_mode.cnf)"></td>
		<td><input type="button" value="ISOStandards" onclick="disp_sel(disp_mode.std)"></td>
		<td><input type="button" value="Up/Down Load" onclick="disp_sel(disp_mode.ud)"></td>
	  </tr>
	</table>
</div>
<div name="tab" style="width: 100%; overflow: hidden;"><!--Morfeas system config-->
    <div style="width:30%;float:left;">
		<input type="button" value="Set">
		<ul id="Comp_UL"></ul>
	</div>
    <div style="width:70%;float:right;">
		<table id="comp_args"></table>
	</div>
</div>
<div name="tab" style="width:100%; overflow:hidden; display:none"><!--ISOStandards-->
</div>
<div name="tab" style="width:100%; overflow:hidden; display:none"><!--Up/DownLoad-->
	<table style="margin:auto;text-align:left;margin-bottom:.075in;">
		<tr>
			<td>
				<form method="post" enctype="multipart/form-data">
					<input type="file" id="bundle" accept=".mbl">
					<input type="button" value="Upload Bundle" onclick="up()">
				</form>
			</td>
		</tr>
		<tr>
			<td><input type="button" value="Download bundle" onclick="down()"></td>
		</tr>
	</table>
</div>
<footer>
  <p>Author: Sam Harry Tzavaras &#169; 12019-12020<br>
  <a href="../LICENSE">License: AGPL v3</a><br>
</footer>
</body>
<script src='../morfeas_ecma/common.js'></script>
<script src='./Morfeas_System_config.js'></script>
<script>
/*
@licstart  The following is the entire license notice for the
JavaScript code in this page.

Copyright (C) 12019-12020  Sam Harry Tzavaras

The JavaScript code in this page is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU AGPL) as published by the Free Software
Foundation, either version 3 of the License, or any later version.
The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU AGPL for more details.

@licend  The above is the entire license notice
for the JavaScript code in this page.
*/
	"use strict";
	comp_check();
	const disp_mode = {
	   cnf: 0,
	   std: 1,
	   ud: 2
	};
	Object.freeze(disp_mode);
	var curr_tab=disp_mode.cnf, curr_config_xml;
	var comp_args_table = document.getElementById("comp_args");
	//AJAX object for configuration receive and send
	var config=null, xhttp = new XMLHttpRequest();
	xhttp.timeout = 5000;
	xhttp.onreadystatechange = function()
	{
		if (this.readyState == 4 && this.status == 200)
		{
			if(this.getResponseHeader("Content-Type")==="application/xml")
			{
				curr_config_xml = this.responseXML.getElementsByTagName("COMPONENTS")[0];
				components_list(curr_config_xml);
			}
			else
				alert(this.responseText);
		}
	};
	xhttp.ontimeout = function(){
		alert("Communication Error!!!");
	};
	function disp_sel(mode)
	{
		if(mode === curr_tab)
			return;
		var tabs = document.getElementsByName("tab");
		tabs.forEach(tab=>{tab.style.display="none"});
		switch(mode)
		{
			case disp_mode.cnf:
				tabs[disp_mode.cnf].style.display="block";
				break;
			case disp_mode.std:
				tabs[disp_mode.std].style.display="block";
				break
			case disp_mode.ud:
				tabs[disp_mode.ud].style.display="block";
				break
		}
		curr_tab = mode;
	}
		
	//Get the configuration
	xhttp.open("GET", "../morfeas_php/config.php"+"?COMMAND=getMorfeasConfig", true);
	xhttp.send();
	
	//Init of FileReader object
	const reader = new FileReader();
	reader.addEventListener('load', function(){
			xhttp.open("POST", "../morfeas_php/config.php", true);
			xhttp.setRequestHeader("Content-type", "Morfeas_bundle");
			xhttp.send(this.result);
		}
	);
	reader.addEventListener('error', function(){alert("File Read Error!!!");});
	//Function for upload a Morfeas Bundle
	function up(data)
	{
		const fileSelector = document.getElementById('bundle');
		const fileList = fileSelector.files;
		reader.readAsArrayBuffer(fileList[0]);
	}
</script>
</html>
