<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="shortcut icon" type="image/x-icon" href="/art/Morfeas_logo_yellow.ico">
<title>Morfeas WEB Links Import</title>
</head>
<body>
	<table style="margin:auto;text-align:center;margin-bottom:.075in;">
		<tr>
			<th colspan="2" style="font-size: 200%;">ISO Channels Import</th>
		</tr>
		<tr>
			<td>	
				<input type="file" id="import_file" accept=".json" onchange="file_read(event)">
			</td>
		</tr>
		<tr>
			<td colspan="2"><textarea id="Logger" style="resize:none;" rows="20" cols="40" value="" readonly></textarea></td>
		</tr>
		<tr>
			<td>
				<input type="button" value="Upload" onclick="upload()" disabled>
			</td>
		</tr>
	</table>
</body>
<script src='../morfeas_ecma/common.js'></script>
<script src='../morfeas_ecma/morfeas_web_if.js'></script>
<script>
//@license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3.0
/*
@licstart  The following is the entire license notice for the
JavaScript code in this page.

Copyright (C) 12021-12022  Sam Harry Tzavaras

The JavaScript code in this page is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU AGPL) as published by the Free Software
Foundation, either version 3 of the License, or any later version.
The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.

@licend  The above is the entire license notice
for the JavaScript code in this page.
*/
"use strict";
comp_check();
var curr_iso_standards, 
	curr_iso_channels,
	import_ISOChannels,
	logger = document.getElementById("Logger");

//Checks and Initialization
if(!curr_iso_standards || !curr_iso_channels)
	window.close('','_parent','');

function file_read(event) 
{
    let input = event.target,
		filename = input.files[0],
		reader = new FileReader();
    
	reader.onload = function(){
		let inp_obj,
			text = reader.result;
		logger.value='';
		import_ISOChannels = undefined;
		logger.value+="Filename: "+filename.name+'\n';
		try{inp_obj = JSON.parse(text)}
		catch(e){
			logger.value+="Error: "+e.message;
			return;
		}
		console.log(typeof(inp_obj));
		if(!inp_obj.length)
		{
			logger.value+="Error: Data isn't array";
			return;
		}
		for(let i=0; i<inp_obj.length; i++)
		{
			
		}
    };
    reader.readAsText(filename);
}
function upload()
{
	if(!import_ISOChannels)
	{
		alert("No Data to upload");
		return;
	}
	/*
	let new_link_data = {}, post_msg_contents = {COMMAND: "", DATA: []},
		post_xhttp = new XMLHttpRequest();
	new_link_data.ISOChannel = iso_name.value+(post_fix.selectedIndex?('_'+post_fix.value):'');
	new_link_data.IF_type = type.value;
	new_link_data.Anchor = sel_dev_anchor;
	new_link_data.Description = desc.value;
	new_link_data.Min = min.value;
	new_link_data.Max = max.value;
	if(link_data[0].selectedIndex > 1)
		new_link_data.Unit = unit_inp.value;
	if(cal_data[0].style.display != "none")
	{
		let cal_date_date = new Date(cal_date.value);
		new_link_data.Cal_date = cal_date_date.getFullYear()+'/'+
								 pad((cal_date_date.getMonth()+1),2)+'/'+
								 pad(cal_date_date.getDate(),2);
		new_link_data.Cal_period = period.value;
	}
	post_xhttp.timeout = 2000;
	post_xhttp.ontimeout = function(){
		status_tab.value = "Connection to server: Timeout Error";
		status_tab.style.color='blue';
	};
	post_xhttp.onreadystatechange = function(){
		if(this.readyState == 4 && this.status == 200)
		{
			if(this.getResponseHeader("Content-Type")==="report/text")
			{
				status_tab.value = this.responseText;
				status_tab.style.color='red';
				console.log(this.responseText);
				alert(this.responseText);
			}
			else if(this.getResponseHeader("Content-Type")==="application/json")
			{
				let report
				try{report = JSON.parse(this.responseText);}
				catch{return;}
				if(report.success)
				{
					if(search_win && !search_win.closed)
						search_win.close();
					window.close('','_parent','');
				}
			}
		}
		else if(this.status == 404)
		{
			status_tab.value = "Error 404: Data Not found";
			status_tab.style.color='red';
		}
	};
	//Prepare message contents.
	post_msg_contents.COMMAND = "ADD";
	post_msg_contents.DATA.push(new_link_data);
	post_xhttp.open("POST", "/morfeas_php/morfeas_web_if.php", true);
	post_xhttp.send(compress(JSON.stringify(post_msg_contents)));
	*/
}
//@license-end
</script>
</html>
